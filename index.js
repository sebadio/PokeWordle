const warning="El intento actual no tiene las suficientes letras",danger="Te quedaste sin intentos, el Pokemon era ",safe="Adivinaste correctamente, Felicidades!",pokemon=document.querySelector(".pokemon"),juegoContainer=document.querySelector(".juegoContainer"),conteinerTipos=document.querySelector(".tipos"),numeroDeTries=6,tecladoInnerHTML=document.querySelector("#teclado").innerHTML;let actualTry=[],nombre="",triesRemaining=6,siguienteLetra=0;const spinner=document.querySelector(".spinner"),showSpinner=()=>{spinner.style.display="block"},hideSpinner=()=>{spinner.style.display="none"},jugar=async()=>{showSpinner();let e=await fetch(`https://pokeapi.co/api/v2/pokemon/${Math.floor(898*Math.random())}/`);e&&404!==e.status||jugar();let t=await e.json();t||jugar(),pokeLog(t)},pokeLog=e=>{let t=document.getElementById("pokemon");nombre=e.species.name,t.src=e.sprites.front_default,t.id="pokemon",t.style.filter="contrast(0)",t.classList.remove("hide"),pokemon.appendChild(t),hideSpinner(),agregarTipos(e),crearTabla()},agregarTipos=e=>{e.types.forEach(e=>{let t=e.type.name,a=document.createElement("img");a.src=`media/tipos/${t}.webp`,a.alt=`${t} Type`,a.width="48",a.height="18",conteinerTipos.appendChild(a)})},crearTabla=()=>{let e=document.createElement("div");e.id="tabla";for(let t=0;t<6;t++){let a=document.createElement("div");a.className="row-boxes";for(let n=0;n<nombre.length;n++){let r=document.createElement("div");r.className="box",a.appendChild(r)}e.appendChild(a)}juegoContainer.appendChild(e)},insertarLetra=e=>{if(siguienteLetra===nombre.length)return;let t=document.getElementsByClassName("row-boxes")[6-triesRemaining],a=t.children[siguienteLetra];a.textContent=e,a.classList.add("box-rellena"),actualTry.push(e),siguienteLetra+=1},borrarLetra=()=>{let e=document.getElementsByClassName("row-boxes")[6-triesRemaining],t=e.children[siguienteLetra-1];t.textContent="",t.classList.remove("box-rellena"),actualTry.pop(),siguienteLetra-=1},comprobarRespuesta=()=>{let e=document.getElementsByClassName("row-boxes")[6-triesRemaining],t=actualTry.join(""),a=nombre,n=document.getElementById("pokemon");if(t.length!=nombre.length){popup("El intento actual no tiene las suficientes letras","warning",!1);return}for(let r=0;r<nombre.length;r++)handleLetter(r,a,e);t===nombre?setTimeout(()=>{popup("Adivinaste correctamente, Felicidades!","safe",!0),n.style.filter="contrast(1)"},250*nombre.length):(triesRemaining-=1,actualTry=[],siguienteLetra=0),0===triesRemaining&&setTimeout(()=>{popup("Te quedaste sin intentos, el Pokemon era "+nombre.toUpperCase(),"danger",!0),n.style.filter="contrast(1)"},250*nombre.length)},colorearLetraTeclado=(e,t)=>{document.querySelectorAll(".teclado-boton").forEach(a=>{if(e===a.textContent){let n=a;!n.classList.contains(t)&&(n.classList.add(t),a.classList.contains("keyWarning")&&"keySafe"==t&&(n.classList.remove("keyWarning"),n.classList.add("keySafe")))}})},borrarTablaYDatos=()=>{document.querySelector("#tabla").parentElement.removeChild(document.querySelector("#tabla")),document.getElementById("pokemon").classList.add("hide"),Array.from(conteinerTipos.children).forEach(e=>{e.parentElement.removeChild(e)}),document.querySelector("#popup").parentElement.removeChild(document.querySelector("#popup"))},playAgain=()=>{borrarTablaYDatos(),triesRemaining=6,siguienteLetra=0,actualTry=[],document.querySelector("#teclado").innerHTML=tecladoInnerHTML,jugar()},popup=(e,t,a)=>{let n=document.createElement("div");if(n.id="popup",n.className=`animacionPopup ${t}`,n.appendChild(document.createTextNode(e)),!0===a){let r=document.createElement("button");r.innerHTML=" Jugar de nuevo ",r.addEventListener("click",playAgain),n.appendChild(r)}document.querySelector(".pokeWordle").appendChild(n),a||setTimeout(()=>{document.querySelector("#popup").parentElement.removeChild(document.querySelector("#popup"))},2500)},handleKeyUp=e=>{if(0===triesRemaining)return;let t=String(e.key);if("Backspace"===t&&0!==siguienteLetra){borrarLetra();return}if("Enter"===t){comprobarRespuesta();return}let a=t.match(/[a-z-]/gi);if("F2"!==t&&"F3"!==t&&"F4"!==t&&"F5"!==t&&"F6"!==t&&"F7"!==t&&"F8"!==t&&"F9"!==t&&"F10"!==t&&"F11"!==t&&"F12"!==t)a&&!(a.length>1)&&insertarLetra(t)},handleScreenKeyboard=e=>{let t=e.target;if(!t.classList.contains("teclado-boton"))return;let a=t.textContent;"Del"===a&&(a="Backspace"),document.dispatchEvent(new KeyboardEvent("keyup",{key:a}))},handleLetter=(e,t,a)=>{let n=200*e,r="",i=a.children[e],o=actualTry[e],l=!1,s=t.indexOf(actualTry[e],e);-1===s&&(r="keyWrong",l=!0),l||actualTry[e]!==t[e]||(r="keySafe",l=!0),l||(r="keyWarning",l=!0),setTimeout(()=>{i.classList.add("animacion"),setTimeout(()=>{i.classList.add(r)},250),colorearLetraTeclado(o,r)},n)};document.addEventListener("keyup",e=>{handleKeyUp(e)}),document.getElementById("teclado").addEventListener("click",e=>{handleScreenKeyboard(e)}),window.onload=()=>{jugar()};